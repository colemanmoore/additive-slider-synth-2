{"version":3,"sources":["SynthContext.js","useSlider.js","constant.js","Slider.js","useSparkle.js","Interface.js","Synth.js","App.js","index.js"],"names":["SynthContext","React","createContext","useSlider","xPosStart","sliderHeight","initialLevel","useState","sliderOffset","setSliderOffset","meterLevel","setMeterLevel","handleMouseUp","document","removeEventListener","handleMouseMove","pageX","layerY","min","input","max","deltaX","Math","addEventListener","pink","green","letters","Container","height","width","float","marginRight","Body","backgroundColor","border","position","left","cursor","display","flexDirection","justifyContent","Slider","pid","noteOn","synth","useContext","voice","sliderColor","setSliderColor","vca","gain","value","handleMouseDown","handleDoubleClick","useEffect","isNaN","voiceGain","voiceDetune","style","onMouseDown","onMouseUp","onDoubleClick","resumeAudio","background","transition","useSparkle","setNoteOn","sparkling","setSparkling","setTimeout","minWidth","margin","Console","padding","Button","color","fontSize","letterSpacing","borderRadius","Hint","fontFamily","lineHeight","marginBottom","Interface","mainRef","useRef","voices","setVoices","waveform","setWaveform","keysElement","setKeysElement","currentNote","setCurrentNote","current","focus","Object","keys","voicesConnected","masterGain","Array","from","map","letter","onKeyDown","keyCode","keyboardInput","onKeyUp","OFF","ref","tabIndex","length","onClick","changeWave","AdditiveSynth","numberOfVoices","audioContext","this","window","AudioContext","webkitAudioContext","console","error","state","log","resume","createGain","connectAllVoices","disconnect","connect","osc","createOscillator","type","frequency","start","destination","stop","cancelScheduledValues","currentTime","setTargetAtTime","freq","filter","pidString","parseInt","forEach","keyToFrequency","noteChange","changeMasterGain","val","cents","detune","changeTo","keyboardMapping","c","csh","d","dsh","e","f","fsh","g","gsh","a","ash","b","c8","d8","textAlign","App","Synth","onFocus","Provider","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.073a10ad.chunk.js","sourcesContent":["import React from 'react'\nconst SynthContext = React.createContext()\nexport default SynthContext","import { useState } from 'react'\n\nconst within = (min, input, max) => Math.min(Math.max(min, input), max)\n\nconst useSlider = ({ sliderHeight = 100, initialLevel = 0.0 }) => {\n  const [sliderOffset, setSliderOffset] = useState(5)\n  const [meterLevel, setMeterLevel] = useState(initialLevel)\n\n  let xPosStart, xPosEnd\n\n  const handleMouseDown = ({ pageX }) => {\n    xPosStart = xPosEnd = pageX\n    document.addEventListener('mousemove', handleMouseMove)\n    document.addEventListener('mouseup', handleMouseUp)\n  }\n\n  const handleMouseUp = () => {\n    document.removeEventListener('mousemove', handleMouseMove)\n    document.removeEventListener('mouseup', handleMouseUp)\n  }\n\n  const handleMouseMove = ({ pageX, layerY }) => {\n    setMeterLevel((sliderHeight - layerY) / sliderHeight)\n    xPosEnd = pageX\n    const deltaX = xPosEnd - xPosStart\n    if (deltaX !== 0) {\n      setSliderOffset(within(0, sliderOffset + deltaX, 10))\n    }\n  }\n\n  const handleDoubleClick = () => {\n    if (meterLevel === 0) {\n      setMeterLevel(0.5)\n    } else {\n      setMeterLevel(0)\n    }\n  }\n\n  return [\n    meterLevel,\n    sliderOffset,\n    handleMouseDown,\n    handleMouseUp,\n    handleDoubleClick\n  ]\n}\n\nexport default useSlider","const sliderBodyColor = '#2a282a'\nconst pink = '#ff4499'\nconst green = '#b3dbac'\nconst letters = 'ASDFGHJKL'\n\nexport {\n  pink,\n  green,\n  sliderBodyColor,\n  letters\n}","import React, { useState, useEffect, useContext } from 'react'\nimport SynthContext from './SynthContext'\nimport useSlider from './useSlider'\nimport { pink, green, sliderBodyColor } from './constant'\n\nconst sliderHeight = 300\n\nfunction Slider({ pid, noteOn }) {\n\n  const synth = useContext(SynthContext)\n  const voice = synth.voice(pid)\n\n  const [sliderColor, setSliderColor] = useState(pink)\n\n  const [meterLevel, sliderOffset, handleMouseDown, handleMouseUp, handleDoubleClick] = useSlider({\n    sliderHeight,\n    initialLevel: !voice ? 0.0 : voice.vca.gain.value\n  })\n\n  useEffect(() => {\n    if(!isNaN(meterLevel)) {\n      synth.voiceGain(pid, meterLevel)\n    }\n  }, [meterLevel, synth, pid])\n\n  useEffect(() => {\n    synth.voiceDetune(pid, sliderOffset)\n  }, [sliderOffset, synth, pid])\n\n  useEffect(() => {\n    setSliderColor(noteOn ? green : pink)\n  }, [noteOn])\n\n  return (\n    <div\n      style={Container}\n      onMouseDown={handleMouseDown}\n      onMouseUp={handleMouseUp}\n      onDoubleClick={() => { synth.resumeAudio(); handleDoubleClick() }}\n    >\n      <div style={{\n        ...Body,\n        left: `${sliderOffset}px`\n      }}>\n        <div\n          style={{\n            height: `${meterLevel * sliderHeight}px`,\n            background: sliderColor,\n            transition: 'height 0.08s'\n          }}\n        />\n      </div>\n    </div>\n  )\n}\n\nconst Container = {\n  height: `${sliderHeight}px`,\n  width: '50px',\n  float: 'left',\n  marginRight: '2px'\n}\n\nconst Body = {\n  backgroundColor: sliderBodyColor,\n  border: 'black 1px solid',\n  width: '40px',\n  height: `${sliderHeight}px`,\n  position: 'relative',\n  left: '5px',\n  cursor: 'grab',\n  display: 'flex',\n  flexDirection: 'column',\n  justifyContent: 'flex-end'\n}\n\nexport default Slider\n","import { useState, useEffect } from 'react'\n\nconst useSparkle = () => {\n  const [noteOn, setNoteOn] = useState(false)\n  const [sparkling, setSparkling] = useState(false)\n\n  useEffect(() => {\n    if (noteOn) {\n      setSparkling(true)\n      setTimeout(() => {\n        setSparkling(false)\n      }, 100)\n    }\n\n    if (!noteOn) {\n      setSparkling(false)\n    }\n  }, [noteOn])\n\n  return [\n    sparkling,\n    setNoteOn\n  ]\n}\n\nexport default useSparkle","import React, { useState, useContext, useEffect, useRef } from 'react'\nimport Slider from './Slider'\nimport SynthContext from './SynthContext'\nimport useSparkle from './useSparkle'\nimport { pink, green, letters } from './constant'\n\nconst Interface = () => {\n\n  const synth = useContext(SynthContext)\n  const [sparkling, setNoteOn] = useSparkle()\n  const mainRef = useRef(null)\n  const [voices, setVoices] = useState([])\n  const [waveform, setWaveform] = useState(synth.waveform)\n  const [keysElement, setKeysElement] = useState(null)\n  const [currentNote, setCurrentNote] = useState(null)\n\n  useEffect(() => {\n    mainRef.current.focus() // so that key events are caught\n  }, [])\n\n  useEffect(() => {\n    setVoices(Object.keys(synth.voices))\n  }, [synth, synth.voices, synth.voicesConnected])\n\n  useEffect(() => {\n    if (synth && synth.masterGain > 0) {\n      setNoteOn(true)\n      setTimeout(() => setNoteOn(false), 100)\n    }\n  }, [synth, synth.masterGain, setNoteOn])\n\n  useEffect(() => {\n    if (currentNote) {\n      setKeysElement(\n        <strong style={{ color: pink }}>\n          {Array.from(letters).map(letter =>\n            letter === currentNote ? <span key={letter} style={{ color: green }}>{letter}</span> : letter\n          )}\n        </strong>\n      )\n    } else {\n      setKeysElement(<strong style={{ color: pink }}>{letters}</strong>)\n    }\n  }, [currentNote])\n\n  const handleKeyDown = ({ keyCode }) => {\n    synth.keyboardInput(keyCode)\n    setCurrentNote({\n      65: 'A',\n      83: 'S',\n      68: 'D',\n      70: 'F',\n      71: 'G',\n      72: 'H',\n      74: 'J',\n      75: 'K',\n      76: 'L'\n    }[keyCode] || null)\n    setNoteOn(true)\n  }\n\n  const handleKeyUp = () => {\n    synth.keyboardInput(synth.OFF)\n    setCurrentNote(null)\n    setNoteOn(false)\n  }\n\n  const changeWave = () => {\n    setWaveform(synth.changeWave())\n  }\n\n  return (\n    <div\n      style={Container}\n      onKeyDown={handleKeyDown}\n      onKeyUp={handleKeyUp}\n      ref={mainRef}\n      tabIndex=\"0\"\n    >\n      <div>\n        {voices.map(pid => (\n          <Slider key={pid} pid={pid} noteOn={sparkling} />\n        ))}\n        <div style={{color: '#ff5'}}>{synth.voices.length}</div>\n      </div>\n\n      <div style={Console}>\n        <span style={Button} onClick={changeWave}>{waveform}</span>\n      </div>\n      <div style={Hint}>press a key: {keysElement}</div>\n    </div>\n  )\n}\n\nconst Container = {\n  minWidth: '700px',\n  margin: '100px auto 50px',\n  position: 'relative',\n  display: 'flex',\n  flexDirection: 'column',\n  justifyContent: 'space-evenly'\n}\n\nconst Console = {\n  padding: '50px',\n}\n\nconst Button = {\n  border: '1px solid #ffffff',\n  color: '#ffffff',\n  fontSize: '1.2rem',\n  letterSpacing: '4px',\n  padding: '10px 20px',\n  borderRadius: '8px',\n  cursor: 'pointer'\n}\n\nconst Hint = {\n  color: '#f49',\n  fontFamily: 'sans-serif',\n  letterSpacing: '3px',\n  fontSize: '1.8rem',\n  lineHeight: '2.15rem',\n  marginBottom: '0.25rem'\n}\n\nexport default Interface","/* Additive Synth */\n\nclass AdditiveSynth {\n\n  OFF = 'OFF'\n  audioContext = null\n  voices = {}\n  numberOfVoices = 0\n  voicesConnected = false\n  waveform = null\n\n  constructor({ numberOfVoices = 12, waveform = 'sine' }) {\n    this.numberOfVoices = numberOfVoices\n    this.waveform = waveform\n  }\n\n  resumeAudio() {\n\n    if (!window.AudioContext && !window.webkitAudioContext) {\n      console.error('Browser does not support audio context')\n      this.voicesConnected = false\n      return\n    }\n\n    if (!this.audioContext) {\n      console.log('creating audio context...')\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)()\n      this.masterGain = this.audioContext.createGain()\n    } else if (this.audioContext.state === 'suspended') {\n      console.log('resuming audio context...')\n      this.audioContext.resume()\n    }\n\n    if (!this.voicesConnected) {\n      this.connectAllVoices()\n    }\n  }\n\n  connectAllVoices() {\n    this.masterGain.disconnect()\n\n    for (let pid = 0; pid < this.numberOfVoices; pid++) {\n      const vca = this.audioContext.createGain()\n      vca.gain.value = (pid === 0 ? 0.5 : 0.0)\n      vca.connect(this.masterGain)\n\n      const osc = this.audioContext.createOscillator()\n      osc.type = 'sine'\n      osc.frequency.value = 0\n      osc.start()\n      osc.connect(vca)\n\n      this.voices[pid] = {\n        osc,\n        vca\n      }\n    }\n\n    this.masterGain.connect(this.audioContext.destination)\n    this.voicesConnected = true\n  }\n\n  disconnectAllVoices() {\n    for (let pid = 0; pid < this.numberOfVoices; pid++) {\n      const { osc, vca } = this.voices[pid]\n      vca.disconnect(this.masterGain)\n      osc.disconnect(vca)\n      osc.stop()\n    }\n\n    this.voices = {}\n    this.voicesConnected = false\n  }\n\n  voice(pid) {\n    return this.voices[pid]\n  }\n\n  changeMasterGain(value) {\n    this.masterGain.gain.cancelScheduledValues(this.audioContext.currentTime)\n    this.masterGain.gain.setTargetAtTime(value, this.audioContext.currentTime, 0.2)\n  }\n\n  noteChange(freq) {\n    Object.keys(this.voices).filter(pidString => !isNaN(parseInt(pidString))).forEach(pid => {\n      this.voice(pid).osc.frequency.value = freq * (parseInt(pid) + 1)\n    })\n  }\n\n  keyboardInput(keyCode) {\n    if (keyCode === this.OFF) {\n      this.changeMasterGain(0.0)\n      return\n    }\n\n    if (this.keyToFrequency(keyCode)) {\n      this.noteChange(this.keyToFrequency(keyCode) / 2)\n      this.changeMasterGain(1.0)\n    }\n  }\n\n  voiceGain(pid, val) {\n    if (this.voices[pid]) {\n      this.voices[pid].vca.gain.value = val / this.numberOfVoices\n    }\n  }\n\n  voiceDetune(pid, cents) {\n    if (this.voices[pid]) {\n      this.voices[pid].osc.detune.value = cents*5\n    }\n  }\n\n  changeWave() {\n    const changeTo = this.waveform === 'triangle' ? 'sine' : 'triangle'\n    Object.keys(this.voices).forEach(pid => {\n      this.voices[pid].osc.type = changeTo\n    })\n    this.waveform = changeTo\n    this.masterGain.gain.cancelScheduledValues(this.audioContext.currentTime)\n    this.masterGain.gain.setTargetAtTime(0.0, this.audioContext.currentTime, 0.2)\n    return changeTo\n  }\n\n  keyToFrequency(keyCode) {\n\n    const keyboardMapping = {\n      65: 'a',\n      83: 'd',\n      68: 'e',\n      70: 'fsh',\n      71: 'g',\n      72: 'a',\n      74: 'b',\n      75: 'c8',\n      76: 'd8'\n    }\n\n    const frequencyMap = {\n      c: 261.6,\n      csh: 277.2,\n      d: 297.7,\n      dsh: 311.1,\n      e: 329.6,\n      f: 349.2,\n      fsh: 370,\n      g: 392.0,\n      gsh: 415.3,\n      a: 440.0,\n      ash: 466.2,\n      b: 493.9,\n      c8: 523.2,\n      d8: 595.4\n    }\n\n    if (keyboardMapping[keyCode]) {\n      return frequencyMap[keyboardMapping[keyCode]]\n    }\n  }\n}\n\nexport default AdditiveSynth\n\n//\n// function initReverb(irUrl) {\n//   // wire it up\n//   convolver.connect(masterGain);\n//   voices.forEach(function(voice) {\n//     voice.vca.connect(convolver);\n//   });\n//\n//   var ajaxRequest = new XMLHttpRequest();\n//   ajaxRequest.open('GET', irUrl, true);\n//   ajaxRequest.responseType = 'arraybuffer';\n//\n//   ajaxRequest.onload = function() {\n//     var irData = ajaxRequest.response;\n//     ctx.decodeAudioData(irData, function(buffer) {\n//       ctx.createBufferSource().buffer = buffer;\n//       convolver.buffer = buffer;\n//     });\n//   };\n//\n//   ajaxRequest.send();\n// }","import React, { useRef } from 'react'\nimport Interface from './Interface'\nimport SynthContext from './SynthContext'\nimport Synth from './Synth'\n\nconst numberOfVoices = 16\n\nfunction App() {\n  const synth = new Synth({ numberOfVoices })\n  synth.voiceGain(0, 0,5)\n\n  const mainRef = useRef(null)\n\n  const makeSureSynthOn = () => {\n    synth.resumeAudio()\n  }\n\n  return (\n    <div style={Container} onFocus={makeSureSynthOn} ref={mainRef}>\n      <SynthContext.Provider value={synth}>\n        <Interface />\n      </SynthContext.Provider>\n    </div>\n  )\n}\n\nconst Container = {\n  textAlign: 'center',\n  display: 'flex',\n  flexDirection: 'column',\n  padding: '50px'\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}